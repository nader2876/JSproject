<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forms Builder</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="form_builder_create.css">
</head>

<body>

    <div class="d-flex">

        <div class="sidebar d-flex flex-column align-items-center">
            <a href="#" class="sidebar-links"><i class="bi bi-table" id="forms_table"></i></a>
            <a href="#" class="sidebar-links"><i class="bi bi-person" id="forms_table"></i></a>

        </div>

        <div class="flex-grow-1 p-4">

            <div class="main-box">

                <h5 style="color:#792C29; font-weight:500;">Form Builder / Create New Form</h5>

                <div class="row mt-3">

                    <div class="col-lg-5 col-md-12 mb-3">

                        <form id="form-info">

                            <div class="mb-3">
                                <label for="formTitle" class="form-label">Title</label>
                                <input type="text" class="form-control" id="formTitle" placeholder="Enter form title">
                            </div>

                            <div class="mb-3">
                                <label for="formDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="formDescription" rows="4"
                                    placeholder="Enter description"></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="formStatus" class="form-label">Form Status</label>
                                <select class="form-select" id="formStatus">
                                    <option>Active (visible to users)</option>
                                    <option>Inactive</option>
                                </select>
                            </div>

                        </form>

                    </div>

                    <div class="col-lg-7 col-md-12">

                        <form id="question-builder">

                            <h6 style="font-weight:500;">Add Question</h6>

                            <div class="mb-3">
                                <label for="questionText" class="form-label">Question Text</label>
                                <input type="text" class="form-control" id="questionText" placeholder="Enter question">
                            </div>

                            <div class="row mb-3 g-3">

                                <div class="col-md-4">
                                    <label for="questionType" class="form-label">Type</label>
                                    <select class="form-select" id="questionType">
                                        <option>Short Text</option>
                                        <option>Multiple Choice</option>
                                        <option>Dropdown List</option>
                                    </select>
                                </div>

                                <div class="col-md-4 d-flex align-items-center">
                                    <div class="form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="requiredSwitch" checked>
                                        <label class="form-check-label" for="requiredSwitch">Required</label>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="fontSelect" class="form-label">Font</label>
                                    <select class="form-select" id="fontSelect">
                                        <option>Arial</option>
                                        <option>Georgia</option>
                                        <option>Other</option>
                                    </select>
                                </div>

                            </div>

                            <div class="mb-3">
                                <label class="form-label">Text Formatting</label>
                                <div class="form-check form-check-inline ms-2">
                                    <input class="form-check-input" type="checkbox" id="boldCheck">
                                    <label class="form-check-label" for="boldCheck">Bold</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="italicCheck">
                                    <label class="form-check-label" for="italicCheck">Italic</label>
                                </div>
                            </div>

                            <div class="mb-3" id="correctAnswerWrapper" style="display: none;">
                                <label for="correctAnswerInput" class="form-label text-success fw-bold">Correct Answer</label>
                                <input type="text" class="form-control border-success" id="correctAnswerInput"
                                    placeholder="Enter the correct answer for Short Text">
                            </div>

                            <div class="card p-3 mb-3" id="questionPreview"
                                style="background:#fff; border-radius:12px;">

                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <p class="mb-0" id="previewText">Question will appear here</p>
                                    <button type="button" class="btn btn-primary btn-sm" id="addQuestionToFormBtn">Add
                                        Question</button>
                                </div>

                                <input type="text" class="form-control mb-2" placeholder="Answer" id="previewAnswer" style="display: none;">

                                <div id="optionsContainer"></div>

                                <button type="button" class="btn btn-outline-secondary mt-2" id="addOptionBtn">Add
                                    Option</button>
                            </div>

                            <div class="card p-3" id="formQuestionsCard" style="background:#fff; border-radius:12px;">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0">Questions in this form</h6>
                                    <button type="button" class="btn btn-brown" id="saveFormBtn">Save Form</button>
                                </div>

                                <div id="questionsList">
                                    </div>
                            </div>


                        </form>

                    </div>

                </div>

            </div>
        </div>

    </div>
    
    <script>
        // ELEMENTS (match your HTML)
        const qText = document.getElementById("questionText");
        const previewText = document.getElementById("previewText");
        const qType = document.getElementById("questionType");
        const requiredSwitch = document.getElementById("requiredSwitch");
        const boldCheck = document.getElementById("boldCheck");
        const italicCheck = document.getElementById("italicCheck");
        const fontSelect = document.getElementById("fontSelect");
        const addOptionBtn = document.getElementById("addOptionBtn");
        const optionsContainer = document.getElementById("optionsContainer");
        const previewAnswer = document.getElementById("previewAnswer"); // now unused in preview, hidden in HTML
        const addQuestionBtn = document.getElementById("addQuestionToFormBtn");
        const questionsList = document.getElementById("questionsList");
        const correctAnswerInput = document.getElementById("correctAnswerInput");
        const correctAnswerWrapper = document.getElementById("correctAnswerWrapper");


        // state
        let styleSettings = { bold: false, italic: false, font: "Arial" };
        let optionCount = 0;
        const MAX_OPTIONS = 4;
        const CORRECT_ANSWER_NAME = "correct_answer_selector"; // Radio button group name

        // helper: apply styles to element
        function applyStyles(el) {
            el.style.fontWeight = styleSettings.bold ? "bold" : "normal";
            el.style.fontStyle = styleSettings.italic ? "italic" : "normal";
            el.style.fontFamily = styleSettings.font;
        }

        // update preview layout & controls
        function updatePreview() {
            // preview text
            previewText.textContent = qText.value || "Question will appear here";
            applyStyles(previewText);

            // show/hide Short Text correct answer input
            if (qType.value === "Short Text") {
                correctAnswerWrapper.style.display = "block";
                addOptionBtn.style.display = "none";
                optionsContainer.innerHTML = ""; // Clear options
                optionCount = 0;
            } else {
                correctAnswerWrapper.style.display = "none";
            }

            // Show Add Option button only for Multiple Choice or Dropdown List
            if (qType.value === "Multiple Choice" || qType.value === "Dropdown List") {
                addOptionBtn.style.display = "inline-block";
                
                // If switching between MC and Dropdown, reset options to change control type
                const currentControl = optionsContainer.querySelector('input[type="radio"], input[type="checkbox"]');
                if (currentControl && qType.value === "Multiple Choice" && currentControl.type !== "radio") {
                    optionsContainer.innerHTML = "";
                    optionCount = 0;
                } else if (currentControl && qType.value === "Dropdown List" && currentControl.type !== "checkbox") {
                    optionsContainer.innerHTML = "";
                    optionCount = 0;
                }

            } else {
                addOptionBtn.style.display = "none";
                
            }
        }

        // add option row (editable text + radio/checkbox and delete button)
        function addOptionRow() {
            if (optionCount >= MAX_OPTIONS) return;
            optionCount++;

            const row = document.createElement("div");
            row.className = "d-flex align-items-center gap-2 mt-2 option-row";
            row.dataset.optionId = optionCount; // unique ID for this option

            // Correct Answer Selector (Radio for MC, Checkbox for Dropdown)
            const control = document.createElement("input");
            control.className = "correct-answer-control";
            
            // Note: Since both MC and Dropdown currently only allow ONE correct answer in this setup, 
            // we use a radio button for selection consistency when building the question.
            // The actual field type (radio vs. dropdown) is only for the user's view in the saved card.
            control.type = "radio";
            control.name = CORRECT_ANSWER_NAME; // Grouped radio buttons
            
            // text input for option label (editable in preview)
            const txt = document.createElement("input");
            txt.type = "text";
            txt.className = "form-control option-text-input";
            txt.placeholder = `Option ${optionCount}`;
            txt.style.maxWidth = "50%";

            // delete button
            const delBtn = document.createElement("button");
            delBtn.type = "button";
            delBtn.className = "btn btn-sm btn-danger ms-2";
            delBtn.textContent = "X";
            delBtn.addEventListener("click", () => {
                row.remove();
                optionCount--;
            });

            // Label for the radio button (indicates this selects the correct answer)
            const label = document.createElement("small");
            label.textContent = "Correct";
            label.className = "text-success fw-bold me-2";


            row.appendChild(control);
            row.appendChild(label);
            row.appendChild(txt);
            row.appendChild(delBtn);

            optionsContainer.appendChild(row);
        }

        // build saved question card based on current preview state
        function buildSavedQuestion() {
            const type = qType.value;
            const optionElements = optionsContainer.querySelectorAll(".option-row");
            let correctAnswer = "";
            let optionsData = [];

            if (type === "Short Text") {
                correctAnswer = correctAnswerInput.value.trim();
            } else {
                // Collect options and identify the correct one
                optionElements.forEach((row, idx) => {
                    const textInput = row.querySelector('.option-text-input');
                    const isCorrect = row.querySelector('.correct-answer-control').checked;
                    
                    const optionValue = textInput.value.trim() || `Option ${idx + 1}`;
                    optionsData.push(optionValue);
                    
                    if (isCorrect) {
                        correctAnswer = optionValue;
                    }
                });
            }

            // --- Generate Card for Display in Questions List ---

            const card = document.createElement("div");
            card.className = "card p-3 mb-2 saved-question-card";
            card.style.borderRadius = "10px";

            // question title with styling
            const q = document.createElement("p");
            q.textContent = qText.value || "Untitled question";
            q.style.marginBottom = "8px";
            q.style.fontWeight = styleSettings.bold ? "bold" : "normal";
            q.style.fontStyle = styleSettings.italic ? "italic" : "normal";
            q.style.fontFamily = styleSettings.font;
            card.appendChild(q);

            // metadata bar
            const meta = document.createElement("div");
            meta.className = "d-flex justify-content-between align-items-center mb-2";
            
            // Required/Type
            const metaLeft = document.createElement("small");
            metaLeft.innerHTML = `Type: <strong>${type}</strong> ${requiredSwitch.checked ? '<span class="text-danger">* Req</span>' : ''}`;
            
            // Correct Answer Display
            const metaRight = document.createElement("small");
            metaRight.innerHTML = `Correct: <strong class="text-success">${correctAnswer || "Not Set"}</strong>`;
            
            meta.appendChild(metaLeft);
            meta.appendChild(metaRight);
            card.appendChild(meta);
            
            // --- Stored Data (for actual submission to database) ---
            
            // You would normally capture this data and send it to the server.
            // For now, we attach it to the card's dataset for demonstration:
            card.dataset.questionText = qText.value;
            card.dataset.questionType = type;
            card.dataset.isRequired = requiredSwitch.checked;
            card.dataset.correctAnswer = correctAnswer;
            card.dataset.options = JSON.stringify(optionsData);
            card.dataset.styles = JSON.stringify(styleSettings);

            return card;
        }

        // events
        qText.addEventListener("input", updatePreview);
        qType.addEventListener("change", updatePreview);

        boldCheck.addEventListener("change", () => {
            styleSettings.bold = boldCheck.checked;
            applyStyles(previewText);
        });
        italicCheck.addEventListener("change", () => {
            styleSettings.italic = italicCheck.checked;
            applyStyles(previewText);
        });
        fontSelect.addEventListener("change", () => {
            styleSettings.font = fontSelect.value;
            applyStyles(previewText);
        });

        // Add option button
        addOptionBtn.addEventListener("click", () => {
            addOptionRow();
        });

        // Add question to form (top-right button inside preview card)
        addQuestionBtn.addEventListener("click", () => {
            // Validation: Question Text Required
            if (!qText.value.trim()) {
                alert("Please enter the question text.");
                return;
            }

            // Validation: Short Text needs an answer
            if (qType.value === "Short Text" && !correctAnswerInput.value.trim()) {
                alert("Please enter the correct answer for the Short Text question.");
                return;
            }
            
            // Validation: MC/Dropdown needs at least 1 option and 1 correct answer selected
            if (qType.value !== "Short Text") {
                const rows = optionsContainer.querySelectorAll(".option-row");
                const isCorrectSelected = optionsContainer.querySelector('.correct-answer-control:checked');

                if (rows.length === 0) {
                    alert("Please add at least one option.");
                    return;
                }
                if (!isCorrectSelected) {
                    alert("Please select the correct option.");
                    return;
                }
            }


            const savedCard = buildSavedQuestion();
            questionsList.appendChild(savedCard);

            // reset builder area
            qText.value = "";
            correctAnswerInput.value = "";
            optionsContainer.innerHTML = "";
            optionCount = 0;
            updatePreview();
        });

        // initialize
        updatePreview();


    </script>
<script src="../../JS/admin.js"></script>


</body>

</html>