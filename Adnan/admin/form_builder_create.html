<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forms Builder</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="form_builder_create.css">
</head>

<body>

    <div class="d-flex">

        <!-- ================= Sidebar ================= -->
        <div class="sidebar d-flex flex-column align-items-center">
            <a href="#" class="sidebar-links"><i class="bi bi-table" id="forms_table"></i></a>
            <a href="#" class="sidebar-links"><i class="bi bi-person" id="forms_table"></i></a>

        </div>

        <!-- ================= Main Content ================= -->
        <div class="flex-grow-1 p-4">

            <div class="main-box">

                <h5 style="color:#792C29; font-weight:500;">Form Builder / Create New Form</h5>

                <div class="row mt-3">

                    <!-- ================= Left Column ================= -->
                    <div class="col-lg-5 col-md-12 mb-3">

                        <form id="form-info">

                            <!-- Title -->
                            <div class="mb-3">
                                <label for="formTitle" class="form-label">Title</label>
                                <input type="text" class="form-control" id="formTitle" placeholder="Enter form title">
                            </div>

                            <!-- Description -->
                            <div class="mb-3">
                                <label for="formDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="formDescription" rows="4"
                                    placeholder="Enter description"></textarea>
                            </div>

                            <!-- Form Status -->
                            <div class="mb-3">
                                <label for="formStatus" class="form-label">Form Status</label>
                                <select class="form-select" id="formStatus">
                                    <option>Active (visible to users)</option>
                                    <option>Inactive</option>
                                </select>
                            </div>

                        </form>

                    </div>

                    <!-- ================= Right Column ================= -->
                    <div class="col-lg-7 col-md-12">

                        <form id="question-builder">

                            <!-- Add Question Title -->
                            <h6 style="font-weight:500;">Add Question</h6>

                            <!-- Question Text -->
                            <div class="mb-3">
                                <label for="questionText" class="form-label">Question Text</label>
                                <input type="text" class="form-control" id="questionText" placeholder="Enter question">
                            </div>

                            <!-- Row: Type / Required / Font -->
                            <div class="row mb-3 g-3">

                                <div class="col-md-4">
                                    <label for="questionType" class="form-label">Type</label>
                                    <select class="form-select" id="questionType">
                                        <option>Short Text</option>
                                        <option>Multiple Choice</option>
                                        <option>Dropdown List</option>
                                    </select>
                                </div>

                                <div class="col-md-4 d-flex align-items-center">
                                    <div class="form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="requiredSwitch" checked>
                                        <label class="form-check-label" for="requiredSwitch">Required</label>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="fontSelect" class="form-label">Font</label>
                                    <select class="form-select" id="fontSelect">
                                        <option>Arial</option>
                                        <option>Georgia</option>
                                        <option>Other</option>
                                    </select>
                                </div>

                            </div>

                            <!-- Text Formatting -->
                            <div class="mb-3">
                                <label class="form-label">Text Formatting</label>
                                <div class="form-check form-check-inline ms-2">
                                    <input class="form-check-input" type="checkbox" id="boldCheck">
                                    <label class="form-check-label" for="boldCheck">Bold</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="italicCheck">
                                    <label class="form-check-label" for="italicCheck">Italic</label>
                                </div>
                            </div>

                            <!-- Question Preview Card -->
                            <div class="card p-3 mb-3" id="questionPreview"
                                style="background:#fff; border-radius:12px;">

                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <p class="mb-0" id="previewText">Question will appear here</p>
                                    <button type="button" class="btn btn-primary btn-sm" id="addQuestionToFormBtn">Add
                                        Question</button>
                                </div>

                                <!-- Short text input -->
                                <input type="text" class="form-control mb-2" placeholder="Answer" id="previewAnswer">

                                <!-- Dynamic options here -->
                                <div id="optionsContainer"></div>

                                <button type="button" class="btn btn-outline-secondary mt-2" id="addOptionBtn">Add
                                    Option</button>
                            </div>

                            <!-- Add Question to Form -->
                            <div class="card p-3" id="formQuestionsCard" style="background:#fff; border-radius:12px;">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0">Questions in this form</h6>
                                    <button type="button" class="btn btn-brown" id="saveFormBtn">Save Form</button>
                                </div>

                                <div id="questionsList">
                                    <!-- Added questions will appear here -->
                                </div>
                            </div>


                        </form>

                    </div>

                </div>

            </div>
        </div>

    </div>



    <script>
        // ELEMENTS (match your HTML)
        const qText = document.getElementById("questionText");
        const previewText = document.getElementById("previewText");
        const qType = document.getElementById("questionType");
        const requiredSwitch = document.getElementById("requiredSwitch");
        const boldCheck = document.getElementById("boldCheck");
        const italicCheck = document.getElementById("italicCheck");
        const fontSelect = document.getElementById("fontSelect");
        const addOptionBtn = document.getElementById("addOptionBtn");
        const optionsContainer = document.getElementById("optionsContainer");
        const previewAnswer = document.getElementById("previewAnswer"); // note: exists in your HTML
        const addQuestionBtn = document.getElementById("addQuestionToFormBtn");
        const questionsList = document.getElementById("questionsList");

        // state
        let styleSettings = { bold: false, italic: false, font: "Arial" };
        let optionCount = 0;
        const MAX_OPTIONS = 4;

        // helper: apply styles to element
        function applyStyles(el) {
            el.style.fontWeight = styleSettings.bold ? "bold" : "normal";
            el.style.fontStyle = styleSettings.italic ? "italic" : "normal";
            el.style.fontFamily = styleSettings.font;
        }

        // update preview layout & controls
        function updatePreview() {
            // preview text
            previewText.textContent = qText.value || "Question will appear here";
            applyStyles(previewText);

            // show/hide preview answer input (only show in preview when Short Text? you requested preview not show input for Short Text)
            // your last instruction: when select "short text" the text input in preview NO NEED it
            // So hide previewAnswer for Short Text, show it for others? Actually earlier you wanted preview input only for Short Text originally.
            // You said: "when i select 'short text' the text input in 'Question will appear here' no need it, but when i add question, the text input must be there."
            // Following that: hide previewAnswer for Short Text; show for others? That is what user asked.
            if (qType.value === "Short Text") {
                previewAnswer.style.display = "none";
            } else {
                // For Multiple/Dropdown we also hide previewAnswer (they said no need the text input in both questions in this form)
                previewAnswer.style.display = "none";
            }

            // Show Add Option button only for Multiple Choice or Dropdown List
            if (qType.value === "Multiple Choice" || qType.value === "Dropdown List") {
                addOptionBtn.style.display = "inline-block";
            } else {
                addOptionBtn.style.display = "none";
                // clear options container if switching to Short Text
                // but keep them if user wants? better clear to avoid confusion
                optionsContainer.innerHTML = "";
                optionCount = 0;
            }
        }

        // add option row (editable text + radio/checkbox and delete button)
        function addOptionRow() {
            if (optionCount >= MAX_OPTIONS) return;
            optionCount++;

            const row = document.createElement("div");
            row.className = "d-flex align-items-center gap-2 mt-2 option-row";

            // control (radio or checkbox) - clickable and disabled in preview? you asked clickable â€” keep enabled
            const control = document.createElement("input");
            if (qType.value === "Multiple Choice") {
                control.type = "radio";
                control.name = `preview_choice_${Date.now()}`; // group per question preview
            } else {
                control.type = "checkbox";
            }

            // text input for option label (editable in preview)
            const txt = document.createElement("input");
            txt.type = "text";
            txt.className = "form-control";
            txt.placeholder = `Option ${optionCount}`;
            txt.style.maxWidth = "50%";

            // delete button
            const delBtn = document.createElement("button");
            delBtn.type = "button";
            delBtn.className = "btn btn-sm btn-danger ms-2";
            delBtn.textContent = "X";
            delBtn.addEventListener("click", () => {
                row.remove();
                optionCount--;
            });

            row.appendChild(control);
            row.appendChild(txt);
            row.appendChild(delBtn);

            optionsContainer.appendChild(row);
        }

        // build saved question card based on current preview state
        function buildSavedQuestion() {
            const card = document.createElement("div");
            card.className = "card p-3 mb-2";
            card.style.borderRadius = "10px";

            // question title with styling
            const q = document.createElement("p");
            q.textContent = qText.value || "Untitled question";
            q.style.marginBottom = "8px";
            q.style.fontWeight = styleSettings.bold ? "bold" : "normal";
            q.style.fontStyle = styleSettings.italic ? "italic" : "normal";
            q.style.fontFamily = styleSettings.font;
            card.appendChild(q);

            // required marker
            if (requiredSwitch.checked) {
                const req = document.createElement("small");
                req.textContent = "* Required";
                req.style.color = "red";
                card.appendChild(req);
            }

            // add control area
            const type = qType.value;

            if (type === "Short Text") {
                // add text input for user
                const input = document.createElement("input");
                input.type = "text";
                input.className = "form-control mt-2";
                input.placeholder = "Answer";
                card.appendChild(input);
            } else if (type === "Multiple Choice") {
                // collect option texts from preview inputs
                const rows = optionsContainer.querySelectorAll(".option-row input[type='text']");
                rows.forEach((txtInput, idx) => {
                    const wrapper = document.createElement("div");
                    wrapper.className = "d-flex align-items-center gap-2 mt-2";

                    const radio = document.createElement("input");
                    radio.type = "radio";
                    radio.name = `saved_mc_${Date.now()}`; // group per saved question
                    radio.disabled = false; // clickable

                    const label = document.createElement("label");
                    label.textContent = txtInput.value || `Option ${idx + 1}`;
                    label.style.marginLeft = "8px";

                    wrapper.appendChild(radio);
                    wrapper.appendChild(label);
                    card.appendChild(wrapper);
                });
            } else if (type === "Dropdown List") {
                const select = document.createElement("select");
                select.className = "form-select mt-2";

                const rows = optionsContainer.querySelectorAll(".option-row input[type='text']");
                rows.forEach((txtInput, idx) => {
                    const opt = document.createElement("option");
                    opt.textContent = txtInput.value || `Option ${idx + 1}`;
                    select.appendChild(opt);
                });

                card.appendChild(select);
            }

            return card;
        }

        // events
        qText.addEventListener("input", updatePreview);
        qType.addEventListener("change", updatePreview);

        boldCheck.addEventListener("change", () => {
            styleSettings.bold = boldCheck.checked;
            applyStyles(previewText);
        });
        italicCheck.addEventListener("change", () => {
            styleSettings.italic = italicCheck.checked;
            applyStyles(previewText);
        });
        fontSelect.addEventListener("change", () => {
            styleSettings.font = fontSelect.value;
            applyStyles(previewText);
        });

        // Add option button
        addOptionBtn.addEventListener("click", () => {
            addOptionRow();
        });

        // Add question to form (top-right button inside preview card)
        addQuestionBtn.addEventListener("click", () => {
            // validation: for MC/Dropdown require at least 1 option
            if ((qType.value === "Multiple Choice" || qType.value === "Dropdown List") && optionsContainer.querySelectorAll(".option-row").length === 0) {
                alert("Please add at least one option.");
                return;
            }

            const savedCard = buildSavedQuestion();
            questionsList.appendChild(savedCard);

            // reset builder area (keep formTitle etc.)
            qText.value = "";
            optionsContainer.innerHTML = "";
            optionCount = 0;
            // reset formatting? keep styling as last chosen (optional). We'll keep it.
            updatePreview();
        });

        // initialize
        updatePreview();


    </script>



</body>

</html>